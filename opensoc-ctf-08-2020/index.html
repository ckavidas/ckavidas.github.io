<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>OpenSOC CTF with Recon Infosec | Costa Kavidas | Your Friend In Infosec</title>
        <meta name="Description" content="On August 8th and August 9th 2020 I participated in the OpenSOC CTF run by Recon Infosec"><meta property="og:title" content="OpenSOC CTF with Recon Infosec" />
<meta property="og:description" content="On August 8th and August 9th 2020 I participated in the OpenSOC CTF run by Recon Infosec" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ckavidas.github.io/opensoc-ctf-08-2020/" />
<meta property="article:published_time" content="2020-08-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-14T00:00:00+00:00" /><meta property="og:site_name" content="Costa Kavidas | Your Friend In Infosec" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OpenSOC CTF with Recon Infosec"/>
<meta name="twitter:description" content="On August 8th and August 9th 2020 I participated in the OpenSOC CTF run by Recon Infosec"/>
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-TileColor" content="#da532c">
<link rel="canonical" href="https://ckavidas.github.io/opensoc-ctf-08-2020/" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="prev" href="https://ckavidas.github.io/kali-lxc-05-2020/" /><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/css/style.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "OpenSOC CTF with Recon Infosec",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/ckavidas.github.io\/opensoc-ctf-08-2020\/"
        },"image": {
                "@type": "ImageObject",
                "url": "https:\/\/ckavidas.github.io\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "CTF, Threat Hunt","wordcount":  1053 ,
        "url": "https:\/\/ckavidas.github.io\/opensoc-ctf-08-2020\/","datePublished": "2020-08-14","dateModified": "2020-08-14","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
                "@type": "Organization",
                "name": "Costa Kavidas",
                "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/ckavidas.github.io\/logo.png",
                "width":  127 ,
                "height":  40 
                }
            },"author": {
                "@type": "Person",
                "name": "Costa"
            },"description": "On August 8th and August 9th 2020 I participated in the OpenSOC CTF run by Recon Infosec"
    }
    </script></head>
    <body><script>
            if (!window.localStorage || !window.localStorage.getItem('theme')) {window.isDark = 'dark' === 'dark';} else {
                window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            }
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/">Costa Kavidas | Your Friend In Infosec</a>
        </div>
        <div class="menu"><a class="menu-item" href="/posts/" rel="noopener noreffer">Posts</a><a class="menu-item" href="/categories/" rel="noopener noreffer">Categories</a><a class="menu-item" href="/about/" rel="noopener noreffer">About</a><a class="menu-item" href="https://github.com/ckavidas" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><span class="menu-item">|</span>
            <a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-wrapper">
        <div class="header-container">
            <div class="header-title">
                <a href="/">Costa Kavidas | Your Friend In Infosec</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="" rel="noopener noreffer">Posts</a><a class="menu-item" href="/categories/" title="" rel="noopener noreffer">Categories</a><a class="menu-item" href="/about/" title="" rel="noopener noreffer">About</a><a class="menu-item" href="https://github.com/ckavidas" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>

<script>
    window.desktopHeaderMode = "fixed";
    window.mobileHeaderMode = "auto";
</script>
<main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animated flipInX">OpenSOC CTF with Recon Infosec</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://ckavidas.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Costa</a>
</span>&nbsp;
                    <span class="post-category">included in<a href="/categories/workshops">
                                <i class="far fa-folder fa-fw"></i>Workshops
                            </a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-08-14>2020-08-14</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>about 1053 words&nbsp;
                <i class="far fa-clock fa-fw"></i>5 min&nbsp;<span id="/opensoc-ctf-08-2020/" class="leancloud_visitors" data-flag-title="OpenSOC CTF with Recon Infosec">
                        <i class="far fa-eye fa-fw"></i><span class=leancloud-visitors-count></span>&nbsp;views
                    </span>&nbsp;</div>
        </div><div class="toc" id="toc-auto">
                <h2 class="toc-title">Contents</h2>
                <div class="toc-content" id="toc-content-auto"></div>
            </div>
            <div class="toc" id="toc-static">
                <details>
                    <summary>
                        <div class="toc-title">
                            <span>Contents</span>
                            <span><i class="details icon fas fa-angle-down"></i></span>
                        </div>
                    </summary>
                    <div class="toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#intro">Intro</a></li>
    <li><a href="#review">Review</a></li>
    <li><a href="#tips-for-the-competition">Tips for the competition</a>
      <ul>
        <li>
          <ul>
            <li><a href="#take-notes">TAKE NOTES!</a></li>
            <li><a href="#use-the-surrounding-events-function-in-graylogkibana">Use the surrounding events function in Graylog/Kibana</a></li>
            <li><a href="#use-the-saved-searches-function-in-kibana">Use the saved searches function in Kibana</a></li>
            <li><a href="#use-the-search-bar-for-consistent-items-and-the-search-box-for-unique-items">Use the search bar for consistent items and the search box for unique items.</a></li>
            <li><a href="#use-virustotal">Use Virustotal!</a></li>
            <li><a href="#use-osquery-to-get-persistence-data">Use OSQuery to get persistence data</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#future-works--ideas-i-would-like-to-explore">Future works / ideas I would like to explore:</a></li>
    <li><a href="#closing-remarks">Closing Remarks</a></li>
  </ul>
</nav></div>
                </details>
            </div><div class="content" id="content"><p><img
        class="lazyload"
        src="/svg/loading.small.min.svg"
        data-sizes="auto"
        data-srcset="/images/opensoc-ctf-2020/banner.png,  1.5x,  2x"
        data-src=""
        alt="Banner"
        title="Banner" /></p>
<hr>
<h2 id="intro">Intro</h2>
<p>On 08/08/2020 and 08/09/2020 I participated in the <strong>OpenSOC CTF</strong> run by <a href="https://twitter.com/recon_infosec" target="_blank" rel="noopener noreffer"><strong>Recon Infosec</strong></a>
. OpenSOC is an open source SOC cyber range running the following software suites:</p>
<ul>
<li><a href="https://www.graylog.org/" target="_blank" rel="noopener noreffer">Graylog</a>
 as a SIEM
<ul>
<li><a href="https://www.elastic.co/kibana" target="_blank" rel="noopener noreffer">Kibana</a>
 was also offered as an optional frontend</li>
</ul>
</li>
<li><a href="https://molo.ch/" target="_blank" rel="noopener noreffer">Moloch</a>
 as a network security monitoring solution
<ul>
<li><a href="https://suricata-ids.org/" target="_blank" rel="noopener noreffer">Suricata</a>
 for network security alerts</li>
</ul>
</li>
<li><a href="https://zeek.org/" target="_blank" rel="noopener noreffer">Zeek</a>
 for networking data</li>
<li><a href="https://osquery.io/" target="_blank" rel="noopener noreffer">OsQuery</a>
 for host information</li>
<li><a href="https://www.velocidex.com/" target="_blank" rel="noopener noreffer">Velociraptor</a>
 for host visibility</li>
<li><a href="https://canary.tools/" target="_blank" rel="noopener noreffer">Thinkst Canary</a>
 for Canary Tokens</li>
</ul>
<p>The CTF is designed to help you learn about the amazing tools in the OpenSOC environment and show you what you can do without the expensive tools. There are storylines that you follow answering questions about what is going on through the usage of the tools listed above. Most storylines were around 70+ questions but you only get the questions one at a time.</p>
<hr>
<h2 id="review">Review</h2>
<p>It was two days full of fun!</p>
<p>There were a handful of technical difficulties and the first day did end early as a result but it gave us an opportunity to stretch our legs. Most of the tools worked flawlessly with the exception of the main one (Graylog/Kibana) which got hammered the hardest throughout the event. One of my regrets was that I never got a chance to use Velociraptor or Thinkst Canary during the event. One of the main reasons for that was that we were able to find just about everything using just Graylog/Kibana, Moloch and OsQuery. The other challenge was that we needed to submit a ticket to get Velociraptor queries done which is hard when you aren&rsquo;t familiar with the tool.</p>
<p>The one question at a time method worked very well for our team, at some points we were answering questions before one of us could finish reading the question. It didn&rsquo;t hurt that I was already familiar with some of the tools (mainly Graylog and Kibana) as well as having a good idea of where to look for most challenges. Our team finished the second day in <strong>29th place</strong> but I only have a screenshot from before we all decided to go to bed.</p>
<p><figure><a class="lightgallery" href="/images/opensoc-ctf-2020/score.png" title="Opensoc-Scoreboard-8-8-2020" data-thumbnail="/images/opensoc-ctf-2020/score.png" data-sub-html="<h2>Our rank before we decided to go to bed.</h2><p>Opensoc-Scoreboard-8-8-2020</p>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-sizes="auto"
            data-srcset="/images/opensoc-ctf-2020/score.png, /images/opensoc-ctf-2020/score.png 1.5x, /images/opensoc-ctf-2020/score.png 2x"
            data-src="/images/opensoc-ctf-2020/score.png"
            alt="Our rank before we decided to go to bed." />
    </a><figcaption class="image-caption">Our rank before we decided to go to bed.</figcaption>
    </figure></p>
<hr>
<h2 id="tips-for-the-competition">Tips for the competition</h2>
<p>If you ever get a chance to attend an OpenSOC event I highly recommend it. Here are some tips I can give for solving the challenges. Out of respect for <strong>Recon Infosec</strong> I will not offer any spoilers.</p>
<h4 id="take-notes">TAKE NOTES!</h4>
<ul>
<li>At the start of day 2 we didn&rsquo;t have notes and we spent at least an hour trying to continue the storyline we were on.</li>
</ul>
<h4 id="use-the-surrounding-events-function-in-graylogkibana">Use the surrounding events function in Graylog/Kibana</h4>
<ul>
<li>Lets say the story up to this point shows that the attackers ran mimikatz on the machine. The next question might ask you to figure out where the attackers laterally moved to from there.</li>
<li>Using the surrounding events function on the mimikatz event will show you events that happened shortly after.</li>
<li>You can filter the related events down to show you only <strong>sysmon event ID 3</strong> to hunt for network connections.</li>
<li>You could also hunt for login events such as <strong>event ID 4624</strong> to try and find out what user was compromised etc.</li>
</ul>
<h4 id="use-the-saved-searches-function-in-kibana">Use the saved searches function in Kibana</h4>
<ul>
<li>There are types of logs you are going to be searching from constantly (example: windows logs or zeek conn.log etc.)</li>
<li>You can save your search and open it up very quickly instead of trying to build queries from scratch.</li>
<li>Unfortunately this was lost on the second day when they reset Kibana and made it read only.</li>
</ul>
<h4 id="use-the-search-bar-for-consistent-items-and-the-search-box-for-unique-items">Use the search bar for consistent items and the search box for unique items.</h4>
<ul>
<li>In Kibana (sorry I don&rsquo;t have a screenshot of this) there is a search box and undernath that there is a bar of search terms. You could for example pin items consistent to the story line (file=winlogbeat, host=hr-12345, event_id=1, etc.) then use the search box to search for &ldquo;malware.exe&rdquo; to get very quick results.</li>
<li>You can even have multiple items in the bar and toggle them on and off (example: a box for event ID 1, 3, 4624, etc.)</li>
</ul>
<h4 id="use-virustotal">Use Virustotal!</h4>
<ul>
<li>There were times in the competition where you would be asked specifics about a binary file on a given system. (Example: SHA256 hash or the name of this file)</li>
<li>One option is to use OSQuery or Velociraptor to obtain this information but my prefered method was to use the MD5 hash obtained from sysmon logs and virustotal.</li>
</ul>
<h4 id="use-osquery-to-get-persistence-data">Use OSQuery to get persistence data</h4>
<ul>
<li>As I became familiar with the structure of the storylines I knew in the future I would get questions about persistence mechanisms.</li>
<li>You can use OSQuery to obtain startup information, scheduled tasks and even WMI persistence data such as <strong>filters, consumers and filter to consumer bindings</strong></li>
</ul>
<hr>
<h2 id="future-works--ideas-i-would-like-to-explore">Future works / ideas I would like to explore:</h2>
<ul>
<li>The competition environment made use of <a href="https://www.zerotier.com/" target="_blank" rel="noopener noreffer"><strong>Zerotier</strong></a>
 to build a virtual network for us to access the tools/scoreboard. I have read the manual for Zerotier and hope to learn how to use it so I can share it with all of you.</li>
<li>I would like to build my own OpenSOC environment but with some exceptions:
<ul>
<li>I personally prefer Kibana to Graylog</li>
<li>I would like to include <a href="https://wazuh.com/" target="_blank" rel="noopener noreffer"><strong>Wazuh</strong></a>
 which is a host-based intrusion detection system.</li>
<li>I would like to build a Zeek Hunting dashboard in Kibana similar to what <a href="https://securityonion.net/" target="_blank" rel="noopener noreffer"><strong>Security Onion</strong></a>
 has.</li>
</ul>
</li>
<li>Adversary simulation is something that is well documented, tools like <a href="https://github.com/redcanaryco/atomic-red-team" target="_blank" rel="noopener noreffer"><strong>Atomic Red Team</strong></a>
 and <a href="https://github.com/mitre/caldera" target="_blank" rel="noopener noreffer"><strong>Caldera</strong></a>
 exist for example. Simulating regular activity on the other hand is not something I have found a solution for. I will need to pick some people&rsquo;s brains to get an idea on how to do that without it being detectable by the log. (Imagine if all legitimate activity on some host was spawned by abc.exe, you could filter out all events where the parent process is abc.exe)</li>
</ul>
<hr>
<h2 id="closing-remarks">Closing Remarks</h2>
<p>I would like to thank the group over at <a href="https://twitter.com/recon_infosec" target="_blank" rel="noopener noreffer"><strong>Recon Infosec</strong></a>
 for putting this event together, most notably <a href="https://twitter.com/eric_capuano" target="_blank" rel="noopener noreffer"><strong>@eric_capuano</strong></a>
 and <a href="https://twitter.com/shortxstack" target="_blank" rel="noopener noreffer"><strong>@shortxstack</strong></a>
. If you ever see an OpenSoc event happening, drop everything and go for it. I would also like to give a special thanks to my team mates <strong><a href="https://twitter.com/haydnjohnson" target="_blank" rel="noopener noreffer">Haydzx</a>
, TDotDavid and Buz</strong>  for being excellent team mates, even though we were short one person we did incredibly well.</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>The article was updated on 2020-08-14</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/ctf">CTF</a>,&nbsp;<a href="/tags/threat-hunt">Threat Hunt</a></section>
        <section>
            <span><a href="javascript:window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/kali-lxc-05-2020/" class="prev" rel="prev" title="Setting Up Kali Linux as an LXC Container"><i class="fas fa-angle-left fa-fw"></i>Setting Up Kali Linux as an LXC Container</a></div>
</div>
<div class="comment"></div>
    </article></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer"><i class="far fa-heart fa-fw"></i> LoveIt</a>
        </div>

        <div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Costa Kavidas</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer>
</div><a href="#" class="dynamic-to-top animated faster" id="dynamic-to-top">
            <i class="fas fa-chevron-up fa-fw"></i>
        </a><script>
        document.addEventListener('DOMContentLoaded', function () {
            lightGallery(document.getElementById('content'), {
                selector: '.lightgallery',
                speed: 400,
                hideBarsDelay: 2000,
                thumbnail: true,
                exThumbImage: 'data-thumbnail',
                thumbWidth: 80,
                thumbContHeight: 80,
            });
        });
    </script><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script src="/lib/smooth-scroll/smooth-scroll.polyfills.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/lightgallery/lightgallery.min.js"></script><script src="/lib/lightgallery/lg-thumbnail.min.js"></script><script src="/lib/lightgallery/lg-zoom.min.js"></script><script src="/js/theme.min.js"></script></body>
</html>
